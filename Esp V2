-- == CONFIG == --
local validKey = "Prri123"
local targetPrefix = "afz"

-- == LIBRARY & UTILS == --
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")

local PlaceId = game.PlaceId
local targetName = "afz"
local cursor = ""
local bestServer = nil
local highestCount = 0
local tried = {}

function Notify(title, text)
	StarterGui:SetCore("SendNotification", {
		Title = server hop,
		Text = afz di temukan !,
		Duration = 5
	})
end

function GetServers()
	local url = "https://games.roblox.com/v1/games/"..PlaceId.."/servers/Public?limit=100"
	if cursor ~= "" then
		url = url.."&cursor="..cursor
	end
	local response = request({Url = url})
	if not response.Success then
		return nil
	end
	local data = HttpService:JSONDecode(response.Body)
	cursor = data.nextPageCursor or ""
	return data.data or {}
end

function HasAFZ(players)
	local count = 0
	for _, user in ipairs(players) do
		local uname = string.lower(user.name or "")
		local dname = string.lower(user.displayName or "")
		if string.find(uname, targetName) or string.find(dname, targetName) then
			count += 1
		end
	end
	return count
end

Notify("Server Scanner", "Mencari server dengan nama "..targetName.."...")

for i = 1, 5 do
	local servers = GetServers()
	if servers then
		for _, srv in ipairs(servers) do
			if srv.playing < srv.maxPlayers and not tried[srv.id] then
				tried[srv.id] = true
				local count = HasAFZ(srv.players or {})
				if count > highestCount then
					bestServer = srv
					highestCount = count
				end
			end
		end
	end
	if cursor == "" then break end
end

if bestServer then
	Notify("Teleporting...", "Ditemukan "..highestCount.." pemain 'aFz'")
	wait(2)
	TeleportService:TeleportToPlaceInstance(PlaceId, bestServer.id, Players.LocalPlayer)
else
	Notify("Gagal", "Tidak ada server cocok ditemukan")
end

-- == GUI SYSTEM == --
local function createKeyGUI()
    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    local gui = Instance.new("ScreenGui", playerGui)
    gui.Name = "KeySystem"

    local frame = Instance.new("Frame", gui)
    frame.Size = UDim2.new(0, 250, 0, 120)
    frame.Position = UDim2.new(0.5, -125, 0.5, -60)
    frame.BackgroundColor3 = Color3.new(0, 0, 0)

    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Text = "Enter Key to Access ESP"
    title.TextColor3 = Color3.new(1, 1, 1)
    title.Font = Enum.Font.SourceSansBold
    title.TextScaled = true
    title.BackgroundTransparency = 1

    local textbox = Instance.new("TextBox", frame)
    textbox.Size = UDim2.new(1, -20, 0, 30)
    textbox.Position = UDim2.new(0, 10, 0, 40)
    textbox.PlaceholderText = "Enter Key..."
    textbox.Text = ""
    textbox.TextColor3 = Color3.new(1, 1, 1)
    textbox.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
    textbox.TextScaled = true
    textbox.Font = Enum.Font.SourceSans

    local button = Instance.new("TextButton", frame)
    button.Size = UDim2.new(1, -20, 0, 30)
    button.Position = UDim2.new(0, 10, 0, 80)
    button.Text = "Submit"
    button.TextColor3 = Color3.new(1, 1, 1)
    button.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    button.TextScaled = true
    button.Font = Enum.Font.SourceSansBold

    button.MouseButton1Click:Connect(function()
        if textbox.Text == validKey then
            gui:Destroy()
            spawn(loadMainGUI)
        else
            textbox.Text = ""
            textbox.PlaceholderText = "Wrong key!"
        end
    end)
end

function loadMainGUI()
    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    local gui = Instance.new("ScreenGui", playerGui)
    gui.Name = "ESP_GUI"

    local frame = Instance.new("Frame", gui)
    frame.Size = UDim2.new(0, 200, 0, 140)
    frame.Position = UDim2.new(0, 20, 0, 100)
    frame.BackgroundColor3 = Color3.new(0, 0, 0)
    frame.Active = true
    frame.Draggable = true

    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Text = "ANTI AFZ ESP"
    title.TextColor3 = Color3.new(1, 1, 1)
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.SourceSansBold
    title.TextScaled = true

    local toggle = Instance.new("TextButton", frame)
    toggle.Size = UDim2.new(1, -10, 0, 30)
    toggle.Position = UDim2.new(0, 5, 0, 35)
    toggle.Text = "ESP: OFF"
    toggle.TextColor3 = Color3.new(1, 1, 1)
    toggle.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    toggle.TextScaled = true
    toggle.Font = Enum.Font.SourceSans

    local hop = Instance.new("TextButton", frame)
    hop.Size = UDim2.new(1, -10, 0, 30)
    hop.Position = UDim2.new(0, 5, 0, 75)
    hop.Text = "Auto Server Hop"
    hop.TextColor3 = Color3.new(1, 1, 1)
    hop.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    hop.TextScaled = true
    hop.Font = Enum.Font.SourceSans

    local credit = Instance.new("TextLabel", frame)
    credit.Size = UDim2.new(1, -10, 0, 20)
    credit.Position = UDim2.new(0, 5, 0, 115)
    credit.Text = "Created by Dark Sistem"
    credit.BackgroundTransparency = 1
    credit.TextColor3 = Color3.new(1, 1, 1)
    credit.Font = Enum.Font.SourceSans
    credit.TextScaled = true

    -- ESP logic
    local espEnabled = false
    local espObjects = {}

    local function clearESP()
        for _, v in pairs(espObjects) do
            if v.label then v.label:Destroy() end
            if v.gui then v.gui:Destroy() end
        end
        espObjects = {}
    end

    RunService.RenderStepped:Connect(function()
        if not espEnabled then
            clearESP()
            return
        end

        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                if string.sub(string.lower(player.Name), 1, #targetPrefix) == targetPrefix then
                    local hrp = player.Character.HumanoidRootPart
                    local distance = (LocalPlayer.Character.HumanoidRootPart.Position - hrp.Position).Magnitude

                    if not espObjects[player] then
                        local billboard = Instance.new("BillboardGui", hrp)
                        billboard.Adornee = hrp
                        billboard.Size = UDim2.new(0, 200, 0, 50)
                        billboard.StudsOffset = Vector3.new(0, 3, 0)
                        billboard.AlwaysOnTop = true

                        local label = Instance.new("TextLabel", billboard)
                        label.Size = UDim2.new(1, 0, 1, 0)
                        label.BackgroundTransparency = 1
                        label.TextColor3 = Color3.new(1, 0, 0)
                        label.TextScaled = true
                        label.Font = Enum.Font.SourceSansBold
                        label.Text = player.Name .. " | " .. math.floor(distance) .. "m"

                        espObjects[player] = {gui = billboard, label = label}
                    else
                        espObjects[player].label.Text = player.Name .. " | " .. math.floor(distance) .. "m"
                    end
                elseif espObjects[player] then
                    espObjects[player].label:Destroy()
                    espObjects[player].gui:Destroy()
                    espObjects[player] = nil
                end
            end
        end
    end)

    toggle.MouseButton1Click:Connect(function()
        espEnabled = not espEnabled
        toggle.Text = espEnabled and "ESP: ON" or "ESP: OFF"
        if not espEnabled then
            clearESP()
        end
    end)

    hop.MouseButton1Click:Connect(function()
        hop.Text = "Hopping..."
        hop.AutoButtonColor = false
        -- jalankan auto server hop sampai ketemu player "afz"
        spawn(function()
            serverHop()
            hop.Text = "Auto Server Hop"
            hop.AutoButtonColor = true
        end)
    end)
end

-- MULAI SCRIPT
createKeyGUI()
