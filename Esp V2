-- == CONFIG == --
local validKey = "Prri123" -- key valid saat ini
local targetPrefix = "afz"

-- == LIBRARY & UTILS == --
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local PlaceId = game.PlaceId
local targetName = "afz"
local cursor = ""
local bestServer = nil
local highestCount = 0
local tried = {}

-- THEME SETUP
local theme = {
 dark = {
  bg = Color3.fromRGB(25, 25, 25),
  text = Color3.fromRGB(230, 230, 230),
  button = Color3.fromRGB(50, 50, 50),
  accent = Color3.fromRGB(180, 0, 180),
  gradientColors = {Color3.fromRGB(255,0,255), Color3.fromRGB(0,255,255), Color3.fromRGB(255,0,255)}
 },
 light = {
  bg = Color3.fromRGB(245, 245, 245),
  text = Color3.fromRGB(30, 30, 30),
  button = Color3.fromRGB(200, 200, 200),
  accent = Color3.fromRGB(180, 0, 180),
  gradientColors = {Color3.fromRGB(255,0,255), Color3.fromRGB(0,255,255), Color3.fromRGB(255,0,255)}
 }
}
local currentTheme = "dark"

-- == FUNCTIONS == --

function Notify(title, text)
 StarterGui:SetCore("SendNotification", {
  Title = title,
  Text = text,
  Duration = 5
 })
end

-- Get server list
function GetServers()
 local url = "https://games.roblox.com/v1/games/"..PlaceId.."/servers/Public?limit=100"
 if cursor ~= "" then url = url.."&cursor="..cursor end
 local response = request and request({Url = url}) or syn and syn.request and syn.request({Url = url}) or error("No HTTP request function found")
 if not response.Success and not response.Success == nil then
  return nil
 end
 local data = HttpService:JSONDecode(response.Body)
 cursor = data.nextPageCursor or ""
 return data.data or {}
end

-- Count players with targetName in username/displayname
function HasAFZ(players)
 local count = 0
 for _, user in ipairs(players) do
  local uname = string.lower(user.name or "")
  local dname = string.lower(user.displayName or "")
  if string.find(uname, targetName) or string.find(dname, targetName) then
   count += 1
  end
 end
 return count
end

-- Server Hop to best server with most afz players
function serverHop()
 Notify("Server Scanner", "Mencari server dengan nama "..targetName.."...")
 bestServer = nil
 highestCount = 0
 tried = {}
 cursor = ""
 for i = 1, 5 do
  local servers = GetServers()
  if servers then
   for _, srv in ipairs(servers) do
    if srv.playing < srv.maxPlayers and not tried[srv.id] then
     tried[srv.id] = true
     local count = HasAFZ(srv.players or {})
     if count > highestCount then
      bestServer = srv
      highestCount = count
     end
    end
   end
  end
  if cursor == "" then break end
 end
 if bestServer then
  Notify("Teleporting...", "Ditemukan "..highestCount.." pemain 'aFz'")
  wait(2)
  TeleportService:TeleportToPlaceInstance(PlaceId, bestServer.id, LocalPlayer)
 else
  Notify("Gagal", "Tidak ada server cocok ditemukan")
 end
end

-- Fling 1: cepat muter dan fling target to void
function flingTarget(targetPlayer)
 if not targetPlayer or not targetPlayer.Character or not targetPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
 local hrp = targetPlayer.Character.HumanoidRootPart
 local localHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
 if not localHRP then return end

 local rotations = 0
 local maxRotations = 20
 local angleStep = math.rad(36)

 local conn
 conn = RunService.Heartbeat:Connect(function()
  if rotations >= maxRotations then
   conn:Disconnect()
   hrp.CFrame = hrp.CFrame + Vector3.new(0, -500, 0)
   Notify("Fling", "Target "..targetPlayer.Name.." sudah di-void!")
   return
  end
  localHRP.CFrame = localHRP.CFrame * CFrame.Angles(0, angleStep, 0)
  localHRP.CFrame = CFrame.new(hrp.Position + Vector3.new(0, 5, 0)) * CFrame.Angles(0, rotations*angleStep, 0)
  rotations += 1
 end)
end

-- Fling 2: khusus Brookhaven, teleport sofa ke target lalu ke void lalu kembali
function fling2Brookhaven(targetPlayer)
 if not targetPlayer or not targetPlayer.Character or not targetPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
 local sofa = nil
 for _, item in pairs(LocalPlayer.Backpack:GetChildren()) do
  if string.lower(item.Name):find("sofa") then
   sofa = item
   break
  end
 end
 if not sofa then
  Notify("Fling 2", "Sofa tidak ditemukan di inventory!")
  return
 end

 local hrpTarget = targetPlayer.Character.HumanoidRootPart
 local localHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
 if not localHRP then return end

 local originalPos = localHRP.CFrame

 sofa.Parent = workspace
 sofa.CFrame = localHRP.CFrame
 wait(0.1)

 sofa.CFrame = hrpTarget.CFrame + Vector3.new(0, 5, 0)
 wait(0.3)

 sofa.CFrame = sofa.CFrame + Vector3.new(0, -500, 0)
 Notify("Fling 2", "Sofa di-void-kan untuk target "..targetPlayer.Name)

 wait(1)

 sofa.CFrame = originalPos
 sofa.Parent = LocalPlayer.Backpack
end

-- Animate GUI transitions
local function tweenGui(obj, props, time, style, dir)
 return TweenService:Create(obj, TweenInfo.new(time or 0.4, style or Enum.EasingStyle.Quad, dir or Enum.EasingDirection.Out), props)
end

-- Background gradient & animation
local function createBackgroundAnimation(parent)
 local bg = Instance.new("Frame", parent)
 bg.Size = UDim2.new(1, 0, 1, 0)
 bg.Position = UDim2.new(0, 0, 0, 0)
 bg.BackgroundTransparency = 1
 bg.ZIndex = 0

 local gradient = Instance.new("UIGradient", bg)
 gradient.Rotation = 45
 gradient.Color = ColorSequence.new(theme[currentTheme].gradientColors)

 spawn(function()
  while parent.Parent and parent.Parent:IsA("PlayerGui") do
   for i = 0, 1, 0.005 do
    gradient.Offset = Vector2.new(i, i)
    wait(0.03)
   end
   for i = 1, 0, -0.005 do
    gradient.Offset = Vector2.new(i, i)
    wait(0.03)
   end
  end
 end)

 return bg
end

-- Clear ESP labels
local espObjects = {}
local espEnabled = false

local function clearESP()
 for _, v in pairs(espObjects) do
  if v.label then v.label:Destroy() end
  if v.gui then v.gui:Destroy() end
 end
 espObjects = {}
end

-- ESP Update Loop
RunService.RenderStepped:Connect(function()
 if not espEnabled then
  clearESP()
  return
 end
 for _, player in pairs(Players:GetPlayers()) do
  if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
   if string.sub(string.lower(player.Name), 1, #targetPrefix) == targetPrefix then
    local hrp = player.Character.HumanoidRootPart
    local distance = (LocalPlayer.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
    if not espObjects[player] then
     local billboard = Instance.new("BillboardGui", hrp)
     billboard.Adornee = hrp
     billboard.Size = UDim2.new(0, 200, 0, 50)
     billboard.StudsOffset = Vector3.new(0, 3, 0)
     billboard.AlwaysOnTop = true

     local label = Instance.new("TextLabel", billboard)
     label.Size = UDim2.new(1, 0, 1, 0)
     label.BackgroundTransparency = 1
     label.TextColor3 = Color3.fromRGB(255, 0, 255)
     label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
     label.TextStrokeTransparency = 0
     label.Text = player.Name
     label.Font = Enum.Font.GothamBold
     label.TextScaled = true

     espObjects[player] = {label = label, gui = billboard}
    end
   else
    if espObjects[player] then
     espObjects[player].label:Destroy()
     espObjects[player].gui:Destroy()
     espObjects[player] = nil
    end
   end
  end
 end
end)

-- == GUI == --

-- GUI utama
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Prri | Script"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame", ScreenGui)
mainFrame.Size = UDim2.new(0, 350, 0, 400)
mainFrame.Position = UDim2.new(0.5, -175, 0.5, -200)
mainFrame.BackgroundColor3 = theme[currentTheme].bg
mainFrame.BorderSizePixel = 0
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.Visible = false

createBackgroundAnimation(mainFrame)

local title = Instance.new("TextLabel", mainFrame)
title.Size = UDim2.new(1, 0, 0, 50)
title.BackgroundTransparency = 1
title.Text = "PRRI HUNT SCRIPT"
title.Font = Enum.Font.GothamBold
title.TextColor3 = theme[currentTheme].text
title.TextScaled = true

local closeBtn = Instance.new("TextButton", mainFrame)
closeBtn.Size = UDim2.new(0, 40, 0, 30)
closeBtn.Position = UDim2.new(1, -45, 0, 10)
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextColor3 = Color3.fromRGB(255, 100, 100)
closeBtn.BackgroundColor3 = Color3.fromRGB(50, 0, 0)
closeBtn.BorderSizePixel = 0
closeBtn.AutoButtonColor = false
closeBtn.MouseEnter:Connect(function()
 closeBtn.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
end)
closeBtn.MouseLeave:Connect(function()
 closeBtn.BackgroundColor3 = Color3.fromRGB(50, 0, 0)
end)
closeBtn.MouseButton1Click:Connect(function()
 mainFrame.Visible = false
 Notify("prri Script", "Script GUI ditutup")
end)

local btnServerHop = Instance.new("TextButton", mainFrame)
btnServerHop.Size = UDim2.new(0, 320, 0, 50)
btnServerHop.Position = UDim2.new(0, 15, 0, 70)
btnServerHop.Text = "Server Hop (Cari server afz)"
btnServerHop.Font = Enum.Font.GothamBold
btnServerHop.TextColor3 = theme[currentTheme].text
btnServerHop.BackgroundColor3 = theme[currentTheme].button
btnServerHop.BorderSizePixel = 0
btnServerHop.MouseButton1Click:Connect(serverHop)

local btnESP = Instance.new("TextButton", mainFrame)
btnESP.Size = UDim2.new(0, 320, 0, 50)
btnESP.Position = UDim2.new(0, 15, 0, 130)
btnESP.Text = "Toggle ESP aFz Players"
btnESP.Font = Enum.Font.GothamBold
btnESP.TextColor3 = theme[currentTheme].text
btnESP.BackgroundColor3 = theme[currentTheme].button
btnESP.BorderSizePixel = 0
btnESP.MouseButton1Click:Connect(function()
 espEnabled = not espEnabled
 if espEnabled then
  Notify("ESP", "ESP aFz diaktifkan")
 else
  clearESP()
  Notify("ESP", "ESP aFz dimatikan")
 end
end)

local targetInput = Instance.new("TextBox", mainFrame)
targetInput.Size = UDim2.new(0, 320, 0, 40)
targetInput.Position = UDim2.new(0, 15, 0, 190)
targetInput.PlaceholderText = "Masukkan nama target untuk Fling"
targetInput.ClearTextOnFocus = false
targetInput.Text = ""

local btnFling1 = Instance.new("TextButton", mainFrame)
btnFling1.Size = UDim2.new(0, 150, 0, 50)
btnFling1.Position = UDim2.new(0, 15, 0, 240)
btnFling1.Text = "Fling Target (Metode 1)"
btnFling1.Font = Enum.Font.GothamBold
btnFling1.TextColor3 = theme[currentTheme].text
btnFling1.BackgroundColor3 = theme[currentTheme].button
btnFling1.BorderSizePixel = 0
btnFling1.MouseButton1Click:Connect(function()
 local targetNameInput = targetInput.Text
 if targetNameInput == "" then
  Notify("Fling", "Masukkan nama target dulu!")
  return
 end
 local targetPlayer = Players:FindFirstChild(targetNameInput)
 if not targetPlayer then
  Notify("Fling", "Player tidak ditemukan!")
  return
 end
 flingTarget(targetPlayer)
end)

local btnFling2 = Instance.new("TextButton", mainFrame)
btnFling2.Size = UDim2.new(0, 150, 0, 50)
btnFling2.Position = UDim2.new(0, 185, 0, 240)
btnFling2.Text = "Fling Target (Metode 2)"
btnFling2.Font = Enum.Font.GothamBold
btnFling2.TextColor3 = theme[currentTheme].text
btnFling2.BackgroundColor3 = theme[currentTheme].button
btnFling2.BorderSizePixel = 0
btnFling2.MouseButton1Click:Connect(function()
 local targetNameInput = targetInput.Text
 if targetNameInput == "" then
  Notify("Fling 2", "Masukkan nama target dulu!")
  return
 end
 local targetPlayer = Players:FindFirstChild(targetNameInput)
 if not targetPlayer then
  Notify("Fling 2", "Player tidak ditemukan!")
  return
 end
 fling2Brookhaven(targetPlayer)
end)

local keyFrame = Instance.new("Frame")
keyFrame.Size = UDim2.new(0, 350, 0, 130)
keyFrame.Position = UDim2.new(0.5, -175, 0.5, -65)
keyFrame.BackgroundColor3 = theme[currentTheme].bg
keyFrame.BorderSizePixel = 0
keyFrame.AnchorPoint = Vector2.new(0.5, 0.5)
keyFrame.Parent = ScreenGui

createBackgroundAnimation(keyFrame)

local keyTitle = Instance.new("TextLabel", keyFrame)
keyTitle.Size = UDim2.new(1, 0, 0, 40)
keyTitle.Position = UDim2.new(0, 0, 0, 0)
keyTitle.BackgroundTransparency = 1
keyTitle.Text = "Masukkan Key Script"
keyTitle.Font = Enum.Font.GothamBold
keyTitle.TextColor3 = theme[currentTheme].text
keyTitle.TextScaled = true

local keyInput = Instance.new("TextBox", keyFrame)
keyInput.Size = UDim2.new(0, 320, 0, 40)
keyInput.Position = UDim2.new(0, 15, 0, 50)
keyInput.ClearTextOnFocus = true
keyInput.PlaceholderText = "Masukkan Key Disini"
keyInput.Text = ""

local keyButton = Instance.new("TextButton", keyFrame)
keyButton.Size = UDim2.new(0, 320, 0, 40)
keyButton.Position = UDim2.new(0, 15, 0, 95)
keyButton.Text = "Submit Key"
keyButton.Font = Enum.Font.GothamBold
keyButton.TextColor3 = theme[currentTheme].text
keyButton.BackgroundColor3 = theme[currentTheme].button
keyButton.BorderSizePixel = 0

keyButton.MouseButton1Click:Connect(function()
 local inputKey = keyInput.Text
 if inputKey == validKey then
  Notify("prri Script", "Key benar! Membuka GUI...")
  keyFrame.Visible = false
  mainFrame.Visible = true
 else
  Notify("prri Script", "Key salah! Silahkan coba lagi.")
  keyInput.Text = ""
 end
end)

-- Mulai dengan menampilkan keyFrame dulu
mainFrame.Visible = false
keyFrame.Visible = true
